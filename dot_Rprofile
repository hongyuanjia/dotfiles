local({
    # set a CRAN mirror
    r <- getOption("repos")
    r["CRAN"] <- "https://mirrors.tuna.tsinghua.edu.cn/CRAN/"
    options(repos = r)

    # unset R_LIBS_SITE and R_LIBS_USER if R is installed using scoop
    path_scoop_r <- normalizePath(file.path(Sys.getenv("USERPROFILE"), "scoop/apps/r/current"), "/", FALSE)
    if (normalizePath(Sys.getenv("R_HOME"), "/", FALSE) == path_scoop_r) {
        Sys.unsetenv("R_LIBS_SITE")
        Sys.unsetenv("R_LIBS_USER")
    }
})

.First <- function() {
    options(
        # use multiple cores
        Ncpus = parallel::detectCores() - 1L,
        datatable.print.class = TRUE,
        # default author name. change accordingly
        usethis.full_name = "Hongyuan Jia",
        # default values in the DESCRIPTION file. change accordingly
        usethis.description = list(
            "Authors@R" = utils::person(
                # default author name
                "Hongyuan", "Jia",
                # default author email
                email = "hongyuanjia@cqust.edu.cn",
                # default role, i.e. aut = author, cre = creator
                role = c("aut", "cre"),
                # default ORCID
                comment = c(ORCID = "0000-0002-0075-8183")
                ),
            # default license of the R code
            License = "MIT + file LICENSE",
            # default package initial version
            Version = "0.0.0.9000"
        )
    )

    # always use English
    if (.Platform$OS.type == "windows") {
        Sys.setenv(LANG = "en")
    } else {
        Sys.setenv(LANG = "en_US.UTF-8")
    }

    # use {pak} to handle package not found error
    if (interactive() && getRversion() >= "4.0.0") {
        globalCallingHandlers(
            packageNotFoundError = function(err) {
                try(pak::handle_package_not_found(err))
            }
        )
    }
}

.setup_pak <- function(update = FALSE) {
    repos <- sprintf(
        "https://r-lib.github.io/p/pak/devel/%s/%s/%s",
        .Platform$pkgType, R.Version()$os, R.Version()$arch
    )

    if (!update && !requireNamespace('pak', quietly = TRUE)) update <- TRUE

    if (update) install.packages('pak', repos = repos)
}

.set_proxy <- function(proxy = "127.0.0.1:7890") {
    Sys.setenv(https_proxy = paste0("http://", proxy))
    Sys.setenv(http_proxy = paste0("http://", proxy))
}

# custom start up
tryCatch(startup::startup(), error = function(ex) message(".Rprofile error: ", conditionMessage(ex)))

# vim: noai:ts=4:sw=4
